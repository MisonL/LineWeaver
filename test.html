<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LineWeaver - 功能测试</title>
    <style>
        body { font-family: monospace; padding: 20px; }
        .test-case { margin: 20px 0; padding: 10px; border: 1px solid #ccc; }
        .pass { color: green; }
        .fail { color: red; }
        pre { background: #f5f5f5; padding: 10px; }
    </style>
</head>
<body>
    <h1>LineWeaver - 功能测试</h1>
    <div id="test-results"></div>

    <script>
        // 引入工具函数
        function removeLineBreaks(text) {
            if (!text || typeof text !== 'string') {
                return '';
            }
            return text
                .replace(/[\r\n]+/g, ' ')
                .replace(/\s+/g, ' ')
                .trim();
        }
        
        // 智能处理文本函数（简化版）
        function smartProcessText(text, options = {}) {
            if (!text || typeof text !== 'string') {
                return '';
            }
            
            const {
                paragraphSeparator = '[PARA]',
                listSeparator = '[LIST]'
            } = options;
            
            let result = text;
            
            // 处理段落
            result = result.replace(/\n\s*\n/g, ` ${paragraphSeparator} `);
            
            // 处理列表项
            result = result.replace(/^\s*\d+[\.\)\uff09]\s+/gm, `${listSeparator}$&`);
            result = result.replace(/^\s*[-\*\+\u2022]\s+/gm, `${listSeparator}$&`);
            
            // 去除剩余换行符
            result = result.replace(/\n/g, ' ');
            
            // 清理多余空格
            result = result.replace(/\s+/g, ' ');
            
            return result.trim();
        }

        // 测试用例
        const testCases = [
            {
                name: '普通换行文本',
                input: '第一行\n第二行\n第三行',
                expected: '第一行 第二行 第三行'
            },
            {
                name: '段落分隔测试（智能模式）',
                input: '第一段文本\n\n第二段文本',
                expected: '第一段文本 [PARA] 第二段文本',
                useSmartMode: true
            },
            {
                name: '数字列表测试（智能模式）',
                input: '1. 第一项\n2. 第二项\n3. 第三项',
                expected: '[LIST]1. 第一项 [LIST]2. 第二项 [LIST]3. 第三项',
                useSmartMode: true
            },
            {
                name: '项目符号列表测试（智能模式）',
                input: '- 项目1\n- 项目2\n• 项目3',
                expected: '[LIST]- 项目1 [LIST]- 项目2 [LIST]• 项目3',
                useSmartMode: true
            },
            {
                name: '混合换行符',
                input: '行1\r\n行2\n行3\r行4',
                expected: '行1 行2 行3 行4'
            },
            {
                name: '多余空格和换行',
                input: '文本1\n\n\n文本2',
                expected: '文本1 文本2'
            },
            {
                name: '空输入',
                input: '',
                expected: ''
            },
            {
                name: '纯空格换行',
                input: '\n   \n   \n',
                expected: ''
            },
            {
                name: '复杂混合场景',
                input: '  开始\r\n\r\n中间内容\n   \n结束  ',
                expected: '开始 中间内容 结束'
            },
            {
                name: '复杂段落和列表（智能模式）',
                input: '第一段内容\n同一段继续\n\n第二段内容\n\n1. 列表项一\n2. 列表项二',
                expected: '第一段内容 同一段继续 [PARA] 第二段内容 [PARA] [LIST]1. 列表项一 [LIST]2. 列表项二',
                useSmartMode: true
            }
        ];

        // 运行测试
        function runTests() {
            const resultsDiv = document.getElementById('test-results');
            let passCount = 0;
            let totalCount = testCases.length;

            testCases.forEach((testCase, index) => {
                const result = testCase.useSmartMode ? 
                    smartProcessText(testCase.input) : 
                    removeLineBreaks(testCase.input);
                const passed = result === testCase.expected;
                
                if (passed) passCount++;

                const testDiv = document.createElement('div');
                testDiv.className = 'test-case';
                const modeText = testCase.useSmartMode ? ' [🧠 智能模式]' : ' [🔄 简单模式]';
                testDiv.innerHTML = `
                    <h3>${testCase.name}${modeText} ${passed ? '<span class="pass">✓ PASS</span>' : '<span class="fail">✗ FAIL</span>'}</h3>
                    <p><strong>输入:</strong></p>
                    <pre>${JSON.stringify(testCase.input)}</pre>
                    <p><strong>期望输出:</strong></p>
                    <pre>${JSON.stringify(testCase.expected)}</pre>
                    <p><strong>实际输出:</strong></p>
                    <pre>${JSON.stringify(result)}</pre>
                    ${!passed ? `<p class="fail"><strong>测试失败！</strong></p>` : ''}
                `;
                
                resultsDiv.appendChild(testDiv);
            });

            // 显示总结
            const summaryDiv = document.createElement('div');
            summaryDiv.innerHTML = `
                <h2>测试总结</h2>
                <p>通过: ${passCount}/${totalCount} (${Math.round(passCount/totalCount*100)}%)</p>
                ${passCount === totalCount ? '<p class="pass">所有测试通过！</p>' : '<p class="fail">部分测试失败，需要修复。</p>'}
            `;
            resultsDiv.appendChild(summaryDiv);
        }

        // 页面加载后运行测试
        window.addEventListener('load', runTests);
    </script>
</body>
</html>
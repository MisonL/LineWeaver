<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LineWeaver - åŠŸèƒ½æµ‹è¯•</title>
    <style>
        body { font-family: monospace; padding: 20px; }
        .test-case { margin: 20px 0; padding: 10px; border: 1px solid #ccc; }
        .pass { color: green; }
        .fail { color: red; }
        pre { background: #f5f5f5; padding: 10px; }
    </style>
</head>
<body>
    <h1>LineWeaver - åŠŸèƒ½æµ‹è¯•</h1>
    <div id="test-results"></div>

    <script>
        // å¼•å…¥å·¥å…·å‡½æ•°
        function removeLineBreaks(text) {
            if (!text || typeof text !== 'string') {
                return '';
            }
            return text
                .replace(/[\r\n]+/g, ' ')
                .replace(/\s+/g, ' ')
                .trim();
        }
        
        // æ™ºèƒ½å¤„ç†æ–‡æœ¬å‡½æ•°ï¼ˆç®€åŒ–ç‰ˆï¼‰
        function smartProcessText(text, options = {}) {
            if (!text || typeof text !== 'string') {
                return '';
            }
            
            const {
                paragraphSeparator = '[PARA]',
                listSeparator = '[LIST]'
            } = options;
            
            let result = text;
            
            // å¤„ç†æ®µè½
            result = result.replace(/\n\s*\n/g, ` ${paragraphSeparator} `);
            
            // å¤„ç†åˆ—è¡¨é¡¹
            result = result.replace(/^\s*\d+[\.\)\uff09]\s+/gm, `${listSeparator}$&`);
            result = result.replace(/^\s*[-\*\+\u2022]\s+/gm, `${listSeparator}$&`);
            
            // å»é™¤å‰©ä½™æ¢è¡Œç¬¦
            result = result.replace(/\n/g, ' ');
            
            // æ¸…ç†å¤šä½™ç©ºæ ¼
            result = result.replace(/\s+/g, ' ');
            
            return result.trim();
        }

        // æµ‹è¯•ç”¨ä¾‹
        const testCases = [
            {
                name: 'æ™®é€šæ¢è¡Œæ–‡æœ¬',
                input: 'ç¬¬ä¸€è¡Œ\nç¬¬äºŒè¡Œ\nç¬¬ä¸‰è¡Œ',
                expected: 'ç¬¬ä¸€è¡Œ ç¬¬äºŒè¡Œ ç¬¬ä¸‰è¡Œ'
            },
            {
                name: 'æ®µè½åˆ†éš”æµ‹è¯•ï¼ˆæ™ºèƒ½æ¨¡å¼ï¼‰',
                input: 'ç¬¬ä¸€æ®µæ–‡æœ¬\n\nç¬¬äºŒæ®µæ–‡æœ¬',
                expected: 'ç¬¬ä¸€æ®µæ–‡æœ¬ [PARA] ç¬¬äºŒæ®µæ–‡æœ¬',
                useSmartMode: true
            },
            {
                name: 'æ•°å­—åˆ—è¡¨æµ‹è¯•ï¼ˆæ™ºèƒ½æ¨¡å¼ï¼‰',
                input: '1. ç¬¬ä¸€é¡¹\n2. ç¬¬äºŒé¡¹\n3. ç¬¬ä¸‰é¡¹',
                expected: '[LIST]1. ç¬¬ä¸€é¡¹ [LIST]2. ç¬¬äºŒé¡¹ [LIST]3. ç¬¬ä¸‰é¡¹',
                useSmartMode: true
            },
            {
                name: 'é¡¹ç›®ç¬¦å·åˆ—è¡¨æµ‹è¯•ï¼ˆæ™ºèƒ½æ¨¡å¼ï¼‰',
                input: '- é¡¹ç›®1\n- é¡¹ç›®2\nâ€¢ é¡¹ç›®3',
                expected: '[LIST]- é¡¹ç›®1 [LIST]- é¡¹ç›®2 [LIST]â€¢ é¡¹ç›®3',
                useSmartMode: true
            },
            {
                name: 'æ··åˆæ¢è¡Œç¬¦',
                input: 'è¡Œ1\r\nè¡Œ2\nè¡Œ3\rè¡Œ4',
                expected: 'è¡Œ1 è¡Œ2 è¡Œ3 è¡Œ4'
            },
            {
                name: 'å¤šä½™ç©ºæ ¼å’Œæ¢è¡Œ',
                input: 'æ–‡æœ¬1\n\n\næ–‡æœ¬2',
                expected: 'æ–‡æœ¬1 æ–‡æœ¬2'
            },
            {
                name: 'ç©ºè¾“å…¥',
                input: '',
                expected: ''
            },
            {
                name: 'çº¯ç©ºæ ¼æ¢è¡Œ',
                input: '\n   \n   \n',
                expected: ''
            },
            {
                name: 'å¤æ‚æ··åˆåœºæ™¯',
                input: '  å¼€å§‹\r\n\r\nä¸­é—´å†…å®¹\n   \nç»“æŸ  ',
                expected: 'å¼€å§‹ ä¸­é—´å†…å®¹ ç»“æŸ'
            },
            {
                name: 'å¤æ‚æ®µè½å’Œåˆ—è¡¨ï¼ˆæ™ºèƒ½æ¨¡å¼ï¼‰',
                input: 'ç¬¬ä¸€æ®µå†…å®¹\nåŒä¸€æ®µç»§ç»­\n\nç¬¬äºŒæ®µå†…å®¹\n\n1. åˆ—è¡¨é¡¹ä¸€\n2. åˆ—è¡¨é¡¹äºŒ',
                expected: 'ç¬¬ä¸€æ®µå†…å®¹ åŒä¸€æ®µç»§ç»­ [PARA] ç¬¬äºŒæ®µå†…å®¹ [PARA] [LIST]1. åˆ—è¡¨é¡¹ä¸€ [LIST]2. åˆ—è¡¨é¡¹äºŒ',
                useSmartMode: true
            }
        ];

        // è¿è¡Œæµ‹è¯•
        function runTests() {
            const resultsDiv = document.getElementById('test-results');
            let passCount = 0;
            let totalCount = testCases.length;

            testCases.forEach((testCase, index) => {
                const result = testCase.useSmartMode ? 
                    smartProcessText(testCase.input) : 
                    removeLineBreaks(testCase.input);
                const passed = result === testCase.expected;
                
                if (passed) passCount++;

                const testDiv = document.createElement('div');
                testDiv.className = 'test-case';
                const modeText = testCase.useSmartMode ? ' [ğŸ§  æ™ºèƒ½æ¨¡å¼]' : ' [ğŸ”„ ç®€å•æ¨¡å¼]';
                testDiv.innerHTML = `
                    <h3>${testCase.name}${modeText} ${passed ? '<span class="pass">âœ“ PASS</span>' : '<span class="fail">âœ— FAIL</span>'}</h3>
                    <p><strong>è¾“å…¥:</strong></p>
                    <pre>${JSON.stringify(testCase.input)}</pre>
                    <p><strong>æœŸæœ›è¾“å‡º:</strong></p>
                    <pre>${JSON.stringify(testCase.expected)}</pre>
                    <p><strong>å®é™…è¾“å‡º:</strong></p>
                    <pre>${JSON.stringify(result)}</pre>
                    ${!passed ? `<p class="fail"><strong>æµ‹è¯•å¤±è´¥ï¼</strong></p>` : ''}
                `;
                
                resultsDiv.appendChild(testDiv);
            });

            // æ˜¾ç¤ºæ€»ç»“
            const summaryDiv = document.createElement('div');
            summaryDiv.innerHTML = `
                <h2>æµ‹è¯•æ€»ç»“</h2>
                <p>é€šè¿‡: ${passCount}/${totalCount} (${Math.round(passCount/totalCount*100)}%)</p>
                ${passCount === totalCount ? '<p class="pass">æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼</p>' : '<p class="fail">éƒ¨åˆ†æµ‹è¯•å¤±è´¥ï¼Œéœ€è¦ä¿®å¤ã€‚</p>'}
            `;
            resultsDiv.appendChild(summaryDiv);
        }

        // é¡µé¢åŠ è½½åè¿è¡Œæµ‹è¯•
        window.addEventListener('load', runTests);
    </script>
</body>
</html>